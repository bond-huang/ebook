# SVC-系统性能
## SVC性能
&#8195;&#8195;SVC性能相关统计文件，可以在收集日志中进行查看，也可以从配置节点上的`/dumps/iostats`目录中进行检索，拷贝示例如下：
```
scp superuser@cluster_name:/dumps/iostats/* /tmp
```
性能相关命令参考：
- [SVC 8.3.x startstats](https://www.ibm.com/docs/en/sanvolumecontroller/8.3.x?topic=commands-startstats)
- [SVC 8.3.x lssystemstats](https://www.ibm.com/docs/en/sanvolumecontroller/8.3.x?topic=commands-lssystemstats)
- [SVC 8.3.x lsnodestats](https://www.ibm.com/docs/en/sanvolumecontroller/8.3.x?topic=commands-lsnodestats)

相关性能文件字段参考：
- [Field Descriptions for SVC / Storwize Performance Data File QSVCVDISK](https://www.ibm.com/support/pages/field-descriptions-svc-storwize-performance-data-file-qsvcvdisk)

### SVC性能相关字段
#### lsnodestats字段说明
命令`lsnodestats`输出部分字段说明：

字段值|描述
:---:|:---
cpu_pc|显示用于系统的已分配CPU容量的百分比
fc_mb|显示系统上光纤通道流量每秒传输的总兆字节数。此值包括主机I/O和用于系统内通信的任何带宽
fc_io|显示系统上光纤通道流量每秒传输的总输入/输出(I/O)操作。此值包括主机I/O和用于系统内通信的任何带宽
write_cache_pc|显示节点的写入缓存使用百分比
total_cache_pc|显示节点的写入和读取缓存使用的总百分比
vdisk_mb|显示采样期间对卷的读取和写入操作每秒传输的平均兆字节数
vdisk_io|显示在采样期间每秒为卷读取和写入操作传输的平均I/O操作数
vdisk_ms|显示系统在采样期间响应对卷的读取和写入请求所需的平均时间量（以毫秒为单位）
mdisk_mb|显示采样期间对MDisk的读取和写入操作每秒传输的平均兆字节数
mdisk_io|显示在采样期间每秒传输到MDisk的读取和写入操作的平均I/O操作数
mdisk_ms|显示系统在采样期间响应对MDisk的读取和写入请求所用的平均时间量（以毫秒为单位）
vdisk_w_mb|显示采样期间对卷的读取和写入操作每秒传输的平均兆字节数
vdisk_w_io|显示在采样期间为写入卷的每秒传输的平均I/O操作数
vdisk_w_ms|显示系统在采样期间响应对卷的写入请求所需的平均时间量（以毫秒为单位）
mdisk_w_mb|显示采样期间对MDisk的写操作每秒传输的平均兆字节数
mdisk_w_io|显示在采样期间为写入MDisk的操作每秒传输的平均I/O操作数
mdisk_w_ms|显示系统在采样期间响应对MDisk的写入请求所用的平均时间量（以毫秒为单位）
vdisk_r_mb|显示采样期间对卷的读取操作每秒传输的平均兆字节数
vdisk_r_io|显示在采样期间每秒传输到卷的读取操作的平均I/O操作数
vdisk_r_ms|显示系统在采样期间响应对卷的读取请求所用的平均时间量（以毫秒为单位
mdisk_r_mb|显示在采样期间对MDisk的读取操作每秒传输的平均兆字节数
mdisk_r_io|显示在采样期间每秒传输到MDisk的读取操作的平均I/O操作数
mdisk_r_ms|显示系统在采样期间响应对MDisk的读取请求所用的平均时间量（以毫秒为单位）

#### dumps/iostats文件中字段
节点的统计信息字段说明：

统计名称|描述
:---:|:---
cluster_id|表示集群的名称
cluster|表示集群的名称
cpu|`busy`- 表示自节点重置以来的总CPU平均核心繁忙毫秒数。该统计数据报告了处理器轮询、等待工作与做工作的时间量。该统计数据从零开始累积
-|`comp`- 表示自重置节点以来压缩进程核心的总CPU平均核心繁忙毫秒数
-|`system`- 表示自节点重置以来的总CPU平均核心繁忙毫秒数。该统计数据报告了处理器轮询、等待工作与做工作的时间量。该统计数据从零开始累积。该统计信息与该`cpu busy`统计信息提供的信息相同，并最终取代该`cpu busy`统计信息
cpu_core|`id`- 表示CPU内核ID
-| `comp`- 表示自节点重置以来压缩进程核心的每个核心 CPU 平均核心繁忙毫秒数
-| `system`- 表示自节点重置以来系统进程核心的每个核心 CPU 平均核心繁忙毫秒数
ID|表示节点的名称
node_id|指示节点的唯一标识符
rb|表示接收的字节数
re|表示累计接收延迟，不包括入站队列时间。此统计数据是节点通信层从I/O排队缓存到缓存为其完成所经历的延迟
ro|表示接收到的消息或批量数据的数量
rq|表示累计接收延迟，包括入站队列时间。这个统计数据是从命令到达节点通信层到缓存完成命令的延迟
wb|表示发送的字节数
we|表示累计发送延迟，不包括出站队列时间。该统计数据是从节点通信层向光纤通道发出消息到节点通信层收到消息到达通知的时间
wo|指示发送的消息或批量数据的数量
wq|表示累计发送延迟，包括出站队列时间。此统计数据包括发送数据的整个时间。该时间包括节点通信层收到消息并等待资源的时间，向远程节点发送消息的时间，以及远程节点响应的时间

各个节点的MDisk的统计信息部分字段说明：

统计名称|描述
:---:|:---
ID|指示应用统计信息的MDisk的名称
idx|指示应用统计信息的MDisk的标识符
pre|指示每个MDisk的读取外部响应时间的峰值（以毫秒为单位）。磁盘读取的外部响应时间是通过在发出 SCSI 读取命令时启动计时器并在命令成功完成时停止来计算的
pro|指示每个MDisk的读取排队响应时间的峰值（以毫秒为单位）。该值表示读取命令从它们加入队列开始所花费的峰值经过时间
pwe|指示每个MDisk的写入外部响应时间峰值（以毫秒为单位）。磁盘写入的外部响应时间是通过在发出 SCSI 写入命令时启动计时器并在命令成功完成时停止来计算的
pwo|指示每个MDisk的写入队列响应时间的峰值（以毫秒为单位）。该值表示写入命令从它们加入队列开始所花费的峰值经过时间
rb|表示读取的数据块的累积数量（自节点开始运行以来）
re|指示每个MDisk的累积读取外部响应时间（以毫秒为单位）。磁盘读取的累积响应时间是通过在发出SCSI读取命令时启动计时器并在命令成功完成时停止来计算的。经过时间被添加到累积计数器中
ro|指示已处理的MDisk读取操作的累积数量（因为节点正在运行）
rq|指示每个MDisk的累积读取排队响应时间（以毫秒为单位）。此响应是从要发送到MDisk的命令队列上方测量的，因为队列深度已满。此计算包括读取命令从它们加入队列开始所用的时间
ure|指示每个MDisk的累积读取外部响应时间（以微秒为单位）。磁盘读取的累积响应时间是通过在发出 SCSI 读取命令时启动计时器并在命令成功完成时停止来计算的。经过时间被添加到累积计数器中
urq|指示每个MDisk的累积读取排队响应时间（以微秒为单位）。此响应是从要发送到MDisk的命令队列上方测量的，因为队列深度已满。此计算包括读取命令从它们加入队列开始所用的时间
uwe|指示每个MDisk的累积写入外部响应时间（以微秒为单位）。磁盘写入的累积响应时间是通过在发出 SCSI 写入命令时启动计时器并在命令成功完成时停止来计算的。经过时间被添加到累积计数器中
uwq|指示每个MDisk的累积写入排队响应时间（以微秒为单位）。此时间是从要发送到MDisk的命令队列上方测量的，因为队列深度已满。此计算包括写入命令从它们加入队列开始所用的时间
wb|表示写入的数据块的累积数量（自节点运行以来）
we|指示每个MDisk的累积写入外部响应时间（以毫秒为单位）。磁盘写入的累积响应时间是通过在发出SCSI写入命令时启动计时器并在命令成功完成时停止来计算的。经过时间被添加到累积计数器中
wo|指示已处理的MDisk写入操作的累积数量（因为节点正在运行）
wq|指示每个MDisk的累积写入排队响应时间（以毫秒为单位）。此时间是从要发送到MDisk的命令队列上方测量的，因为队列深度已满。此计算包括写入命令从它们加入队列开始所用的时间

单个节点的卷的统计信息部分字段说明：

字段值|描述
:---:|:---
idx|应用统计信息的卷
rb|读取的数据块的累积数量(自节点运行以来)
rl|每个卷的累积读取响应时间(单位ms)。卷读取的累积响应时间是通过在收到 SCSI 读取命令时启动计时器并在命令成功完成时停止来计算的，经过时间被添加到累积计数器中
rlw|自上次收集统计信息以来每个卷的最差读取响应时间(单位µs)。在每个统计收集样本之后，此值重置为零
ro|已处理的卷读取操作的累积数量(自节点开始运行以来)
rxl|自上次重置节点以来每个卷的累积读取数据传输响应时间(单位ms)。此统计数据的高值表明延迟可能是由结构和/或主机提交的读取命令多于其处理能力引起的
ub|表示未映射的数据块的累积数量(因为节点正在运行)
ul|每个卷的累积取消映射响应时间(单位ms)。卷取消映射的累积响应时间是通过在收到 SCSI 取消映射命令时启动计时器并在命令成功完成时停止来计算的。经过时间被添加到累积计数器中。
ulw|每个卷的最差取消映射响应时间(单位µs)。卷取消映射的最差响应时间是通过在收到 SCSI 取消映射命令时启动计时器并在命令成功完成时停止来计算的
uo|已处理的卷取消映射操作的累积数量(自节点开始运行以来)
uou|未在8 K边界上对齐的卷取消映射操作的累积数量
wb|写入的数据块的累积数量(自节点运行以来)
wl|每个卷的累积写入响应时间(以毫秒为单位)。卷写入的累积响应时间是通过在收到 SCSI 写入命令时启动计时器并在命令成功完成时停止来计算的。经过时间被添加到累积计数器中
wlw|自上次收集统计信息以来每个卷的最差写入响应时间(单位µs)。在每个统计收集样本之后，此值重置为零
wo|已处理的卷写入操作的累积数量(因为节点正在运行)
wou|未在 4 K 边界上对齐的卷写入操作的累积数量。
wxl|自上次重置节点以来每个卷的累积写入数据传输响应时间(单位ms)。此统计数据的高值表示延迟可能是由于节点请求数据写入卷时结构和/或主机响应缓慢造成的。
xl|自上次重置节点以来每个卷的累积读取和写入数据传输响应时间(单位ms)

每个节点的卷缓存的统计部分字段说明：

字段值|描述
:---:|:---
cm|缓存中保存的已修改或脏数据的扇区数
ctd|由于卷缓存刷新或降级操作而被启动写入、提交给其他组件的缓存降级总数
ctds|为cache-initiated的磁道写入而写入的扇区总数
ctp|由cache-initiated的前置读取的磁道阶段数
ctps|缓存启动的暂存扇区的总数
ctrh|对前置或非前置数据的总磁道读取缓存命中数。例如，跨越两个磁道的单个读取，其中只有一个磁道获得了总缓存命中，计为一个磁道读取缓存命中
ctrhp|从其他组件接收到的磁道读取数，这些数据被视为对任何预留数据的缓存命中
ctrhps|为从其他组件接收到的读取而读取的扇区总数，这些组件在任何预留数据上获得缓存命中。
ctrhs|为从其他组件接收到的读取而读取的扇区总数，这些组件在前置或非前置数据上获得了总缓存命中
ctr|接收到的磁道读取总数。例如，如果单次读取跨越两个磁道，则将其计为两次总磁道读取
crts|为接收到的读取而读取的扇区总数
ctwft|从其他组件接收并以flush-through写入模式刷新处理的磁道写入数
ctwfts|从其他组件接收并以fflush-through写入模式刷新的写入而写入的扇区总数
ctwfw|从其他组件接收并在fast-write模式下处理的磁道写入数
ctwfwsh|由于内存不足，以write-through模式写入的磁道以fast-write模式写入
ctwfwshs|由于内存不足，直接写入的磁道以fast-write模式写入
ctwfws|从其他组件接收并以fast-write模式处理的写入而写入的扇区总数
ctwh|从其他组件接收到的磁道写入次数，其中磁道中的每个扇区都对缓存中的已脏数据进行了写命中。要将写入计为总缓存命中，整个磁道写入数据必须已在写入缓存中标记为脏
ctwhs|从其他组件接收到的扇区总数，其中磁道中的每个扇区都对缓存中的已脏数据进行了写入命中
ctw|接收到的磁道写入总数。例如，如果一次写入跨越两个磁道，则将其计为两次总磁道写入
ctws|从组件接收到的写入而写入的扇区总数
ctwwt|从其他组件接收并在write-through模式下处理的磁道写入数
ctwwts|为从其他组件接收并在write-through模式下处理的写入而写入的扇区总数
cv|表示缓存中保存的读写缓存数据的扇区数

卷和卷副本的缓存统计信息部分字段说明：

字段值|描述
:---:|:---
ri|读ios，累积数据
wi|写ios，累积数据
r|读未命中的扇区，累积数据
rh|读命中的扇区，累积数据
ft|flush_through 写入的扇区，累积数据
fw|fast_write写入的扇区，累积数据
wt|write_through写入的扇区，累积数据
wh|写命中的扇区，累积数据
m|修改数据的扇区，快照非累积数据
v|读和写缓存数据，快照非累积数据
d|destages
dav|destage延迟平均值，单位µs，非累积值
dcn|destage计数，累积数据
sav|stage延迟平均值，单位µs，非累积值
scn|stage计数，累积数据
pp|固定百分比
tav|数据传输延迟平均值，单位µs，非累积值
teav|跟踪锁定延迟(不包括)平均值，单位µs，非累积值
tsav|跟踪锁定延迟(共享)平均值，单位µs，非累积值

各个节点的高速镜像和全局镜像关系中的卷的统计信息字段说明：

统计名称|描述
:---:|:---
gwl|主VDisk：此统计数据累积主写入延迟，即主全局镜像写入完成后，直到在辅助集群中接收和硬化数据并且通知已发送回主集群并由主集群接收所用的时间. 一个操作的平均值可以通过除以`gwl`（`gws`采样周期内的全局镜像写入次数）得到。运行时，`gwl`/的值`gws`大约是恢复点目标 (RPO)。当关系停止时，此计算不起作用。 辅助VDisk：此统计数据累积辅助写入延迟，即辅助集群上收到写入后提交写入磁盘所用的时间。 一个操作的平均值可以通过除以`gwl`（`gws`采样周期内的全局镜像写入次数）得到
gwo|指示重叠卷写入的总数。重叠写入是指写入请求的逻辑块地址 (LBA) 范围与对同一 LBA 范围的另一个未完成的请求发生冲突，并且该写入请求对于辅助站点仍然未完成
gwot|指示固定或不固定重叠写入的总数。当所有集群中的所有节点都处于系统版本 4.3.1 时，此统计信息记录了主节点上全局镜像功能接收到的写入 I/O 请求的总数重叠。当任一集群中的任何节点运行早于 4.3.1 的系统版本时，此值不会增加
gws|指示向辅助站点发出的写入请求总数

节点端口的统计信息部分字段说明：

统计名称|描述
:---:|:---
bbcz|指示缓冲区信用计数器为零的总时间（以微秒为单位）。该统计信息仅由 8 Gbps 光纤通道端口报告。对于其他端口类型，此统计数据为0
cbr|表示从控制器接收的字节
cbt|指示传输到磁盘控制器的字节数
cer|指示从磁盘控制器接收的命令。注意：cer指标始终为 0
cet|指示向磁盘控制器发起的命令
dtdc|指示经历过数据传输延迟的传输次数
dtdm|表示已测量其数据传输延迟的传输次数
dtdt|指示数据传输过度延迟的总时间（以微秒为单位）
har|指示在数据传输过程中中止主机读取操作的计数。此计数包括主机中止的I/O操作，以及系统内部中止的操作
haw|指示在数据传输过程中中止主机写入操作的计数。此计数包括主机中止的I/O操作，以及系统内部中止的操作
hbr|表示从主机接收的字节数
hbt|指示传输到主机的字节数
her|表示从主机接收的命令
het|指示向主机发起的命令。注意：het指标始终为0
hsr|指示对于主机读取操作而言被认为较慢的数据传输计数
hsw|指示对于主机写入操作而言被认为较慢的数据传输计数
icrc|表示无效的CRC数
id|指示节点的端口标识符
itw|表示无效的传输字数
lf|指示链路故障计数
lnbr|指示接收到同一集群中其他节点的字节数
lnbt|表示传输到同一集群中其他节点的字节数
lner|表示从同一个集群中的其他节点接收到的命令
lnet|表示向同一个集群中的其他节点发起的命令
lsi|指示信号丢失计数
lsy|指示同步丢失计数
pspe|表示原始序列协议错误计数
rmbr|指示接收到其他集群中其他节点的字节数
rmbt|指示传输到其他集群中其他节点的字节数
rmer|表示从其他集群中的其他节点接收到的命令
rmet|指示向其他集群中的其他节点发起的命令
wwpn|指示节点的全局端口名称

更多性能统计名称参考官方文档：[SVC Starting statistics collection](https://www.ibm.com/docs/en/sanvolumecontroller/8.3.x?topic=troubleshooting-starting-statistics-collection)
## 池性能
### 池性能注意事项
Pool performance注意事项：
- 不要在一个池中混用`same-tier`或具有不同性能特征的MDisk。这种技术是确保从池中创建的卷具有一致的性能特征的唯一方法
- 允许在一个池中使用不同层的阵列，因为它们的性能差异将通过使用Easy Tier功能变得有利
- 如果需要将特定工作负载隔离到单独的存储中，请创建多个存储池
- 确保针对选定的池类型和功能集完成了性能调整

### 池和缓存的关系
&#8195;&#8195;系统使用缓存分区来限制性能不佳的存储控制器可能对集群系统产生的潜在负面影响。缓存分区分配大小基于配置的存储池的数量。此设计可防止单个过载的后端存储系统填充系统写入缓存并降低其他存储池的性能。下表是单个存储池可以使用的`write-cache`数据限制：

存储池数量|上限
:---:|:---:
1|100%
2|66%
3|40%
4|30%
5或更多|25%

性能影响：
- 只有针对受影响存储池的写入受到限制。对受限制池的读取`I/O`请求继续正常处理。但是由于系统后端存储可以维持的最大速率卸载缓存数据，因此预计读取响应时间会受到影响
- 发往其他（非限制）存储池的所有`I/O`将照常继续