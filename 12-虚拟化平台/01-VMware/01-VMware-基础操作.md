# VMware-基础操作
个人版用的比较多，企业版用的比较少，一些简单操作记录下来避免忘记。
## 存储迁移
&#8195;&#8195;VMware平台上一台物理机上有多个虚拟机，一块分配过来的存储盘也经常给多个虚拟机使用。在替换后端存储的时候，可以通过VMware上的虚拟机迁移功能去迁移虚拟机的存储盘（只改变存储盘，不改变虚拟机所在的物理机），优点就是在线迁移，单个虚拟机也很快；缺点就是如果比较多虚拟机太慢了，并发量也需要控制，避免I/O过高产生影响。

具体迁移步骤如下：
- 将新存储跟集群物理机划分好zone，将新磁盘分配给集群，
- 登录VMware的vSphere client，选择对应的集群
- 右键，在`Storage`选择中选择`Rescan Storage`
- 在弹出的“重新扫描存储”对话框中，选择“扫描新的存储设备”，不选中“扫描新的VMFS卷”
- 弹出对话框“新建数据存储”:
    - 类型：选择`VMFS`
    - 名称和设备选择：自定义数据存储名称（例如叫VOLnew）；选择集群中任意一个主机，然后可以看到扫描到的磁盘，选择需要添加的磁盘
    - VMFS版本：有些版本会有此步骤，选择对应的即可
    - 分区配置：默认使用过所有可用分区
    - 即将完成：检查配置，没问题就点击`FINISH`
- 在左侧集群菜单里面可用看到新分配的存储盘：VOLnew
- 点击选择就旧存储盘，例如叫：VOLold，查看存储盘下所有Virtual Machines
- 选中需要迁移得虚拟机，右键，选择`Migrate`(会提示兼容性）：
    - 选择迁移类型：仅更改存储（根据需求选择）
    - 选择存储：磁盘格式选择精简置配；虚拟机存储策略选择保留现有得虚拟机存储策略；勾上禁用此虚拟机得存储DRS;最后选中目标磁盘VOLnew
    - 即将完成：检查配置，没问题就点击`FINISH`
- 然后可以看到精度条，迁移完成后进行检查

注意事项：
- 可以一次选择多个虚拟机进行迁移，但是批量迁移的虚拟机都必须处于同一电源状态
- 批量迁移注意I/O量，一次性过多可能会影响到其它虚拟机正常运行，存储端的性能同样需要关注
- 有些虚拟机可能迁移不了，重启下物理机可能就解决了
- 有些集群开启了自动均衡功能，就是他会自动迁移虚拟机到比较闲的磁盘，可以更改此策略或者对于不打算用的旧盘标记成维护模式
- 确认不要的盘建议核实清楚没有了虚拟机在上面后再删除，最好先标记成维护模式（很多卷名称可能差不多，标记成维护模式的图标会发生改变，区别正在使用磁盘比较明显），过后再删除

## 虚拟机删除
### SVC存储磁盘虚拟机清理
需要收集确认的信息：
- 虚拟机IP:192.168.100.110
- 虚拟机所在物理主机的IP：192.168.100.210
- 虚拟机名称：snap_test
- 虚拟机磁盘名称：snap-282b8f27-snap_test_Pool_5T
- VMwate上查看磁盘ID:IBM Fibre Channel Disk (naa.600507680180875b2000000000000462)
    - 需要与SVC上一直
- VMware上LUN ID 62
- SVC上卷名称：VMware_snap_test_Pool_5T
- SVC上映射关系：Lenovo1_vmeare

步骤如下：
- 首先关闭虚拟机
- 虚拟机删除磁盘：操作-编辑设置--删除磁盘--点击确定
- VMcenter上找到磁盘：选择虚拟机，右键：从磁盘删除，点击确认
- VMcenter上找到磁盘：操作--卸载数据存储--弹出对话框选择需要卸载的主机--点击确认

主机上分离磁盘：
- 主菜单选择配置--存储展开选择存储设备：找到对于LUN，选中后点击上面 分离选项，点击确认，查看状态是否分离
- SVC取消映射：找到卷，右键--取消映射所有主机（或者指定主机）
- 重新扫描磁盘：找到主机，右键，选中存储--重新扫描存储。查看删掉存储是否已经无法识别
- 删除虚拟机：卸载数据存储之后，这个虚拟机就没有了

## 待补充
