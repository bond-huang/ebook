# LinuxONE-OpenStack云平台使用手册
结合上机实践步骤，简单用文字记录使用手册，官方手册图文并茂，手册地址：[LinuxONE高密度云最佳实践成长之路 (KVM版）](https://csc.cn.ibm.com/roadmap/index/e96159c6-cf9b-47cb-bb13-17cb5cecdaf7?eventId=)
## OpenStack简介
&#8195;&#8195;OpenStack是一个开源的云计算管理平台项目，是一系列软件开源项目的组合。由NASA(美国国家航空航天局)和Rackspace合作研发并发起，以Apache许可证（Apache软件基金会发布的一个自由软件许可证）授权的开源代码项目。

官方网站：[https://www.openstack.org/](https://www.openstack.org/)      
官方文档：[https://docs.openstack.org/](https://docs.openstack.org/)       
GitHub：[https://github.com/openstack/openstack](https://github.com/openstack/openstack)

## 普通用户使用手册
在浏览器中输入`http://IP/dashboard`会看进入到登录界面。
### 实例
#### 创建实例
步骤如下：
- 在`项目`>`计算`>`实例`页面的右上角点击`创建实例`
- 输入实例名称、数量，选择虚拟机模板
- 在`源`界面选择镜像，点击右侧向上的箭头表示选中，若已选中点击`下一步`
- 在`示例类型`界面选择实例类型，点击右侧向上的箭头表示选中，若已选中点击`下一步`
- 选择网络（右侧向上的箭头表示选中）后并点击`创建实例`
- 在`项目`>`计算`>`实例`页面可以查看创建的实例
- 等待示例状态为`运行`

#### 虚拟机关机
步骤如下：
- 在`项目`>`计算`>`实例`页面选中需要关闭的实例
- 在`项目`>`计算`>`实例`页面的右上角点击`更多操作`
- 在下来菜单中选中`关闭实例`
- 在`项目`>`计算`>`实例`页面可以查看实例状态

#### 虚拟机开机
步骤如下：
- 在`项目`>`计算`>`实例`页面中实例列表后面`动作`列，点击`启动实例`
- 在`项目`>`计算`>`实例`页面可以查看实例状态

#### 使用console 进入操作系统
输入如下命令查看test的信息：
```
# openstack server show test
```
&#8195;&#8195;查看host和instance_name，示例中DX1ALAPP2为承载虚拟机的host, 虚拟机的instance_name为instance-000000cd，登录到DX1ALAPP2进入虚拟机：
```
# virsh console instance-000000cd
```
#### 更改虚拟机配置
&#8195;&#8195;系统上线之后，随着生产的需要很可能需要对现有的虚拟机更改配置，比如扩展CPU,内存或磁盘。示例虚拟机的ip为16.35.161，示例大小为2C1G5G，步骤如下：
- 在`项目`>`计算`>`实例`页面中`动作`列选项对应实例下拉菜单中找到`调整实例大小`
- 弹出`调整实例大小`对话框，在`新的实例类型`选项中写入新的大小,格式:`2c1g10g`
- 在`调整实例大小`对话框点击`调整大小`
- 在`项目`>`计算`>`实例`页面中实例列表后面`动作`列选项对应实例下拉菜单中点击`确认调整大小/迁移`
- 在`项目`>`计算`>`实例`页面可以查看实例类型是否调整

#### 虚拟机救援
&#8195;&#8195;当虚拟机密码忘记或者发生故障进不去操作系统时，可以使用此功能把虚拟机的系统盘临时作为第二块盘挂载到操作系统，进行虚拟机救援，类似于物理机的救援模式。
- 在`项目`>`计算`>`实例`页面中`动作`列选项对应实例下拉菜单中找到`救援云主机`
- 在对话框`救援云主机`中选择`ubuntu-rescue`这个镜像（根据实际需求），点击确认
- 进入系统后，挂载/dev/vdb 到系统即可进行修改

#### 重建实例
&#8195;&#8195;当一个虚拟机物理在计划内或者计划外想要之前虚拟机的IP和配置时可以进行重建，此时虚拟机的disk会被重新配置。之前的cpu、内存、网络会被保留。
- 在`项目`>`计算`>`实例`页面中`动作`列选项对应实例下拉菜单中找到`重建实例`
- 在对话框`重建实例`中选择镜像点击重建实例即可

#### 虚拟机热迁移
热迁移这个动作只能用管理员来执行，所以先点击管理员，再找到对应的实例，点击实例热迁移：
- 在`项目`>`计算`>`实例`页面中`动作`列选项对应实例下拉菜单中找到`实例热迁移`
- 选择新的目标主机，若有共享存储，则直接选择提交， 若没有共享存储，要把块迁移选项勾选然后点击提交

### 镜像
#### 创建镜像
命令如下：
```
# openstack image create "rhel7" --file rhel7-compress.qcow2 \
--property architecture=s390x --disk-format qcow2 \
--container-format bare  --public
```
#### 查看镜像
在主菜单`项目`>`计算`>`镜像`页面中可以查看创建的镜像。

### 网络
#### 查看SDN网络拓扑
&#8195;&#8195;在`项目`>`网络`>`网络拓扑`页面中可以查看网络拓扑，当前网络拓扑不仅可以看到当前网络，还可以看到所关联的虚拟机。
#### 查看当前网络
在`项目`>`网络`>`网络`页面中可以查看当前网络状态。

#### 添加安全规则
示例添加ssh：
- 点击`项目`>`网络`>`安全组`>`管理规则`
- 点击`添加规则`后点击`定制TCP规则`
- 选择最后一项`SSH`,然后点击`添加`
- 通过终端ssh到此实例进下测试

## 管理员用户使用手册
### 创建网络
步骤如下：
- 在`项目`>`网络`>`网络`页面中右上角点击`创建网络`选项
- 在`创建网络`对话框中输入配置（根据需求）：名称，项目，网络类型，物理网络，勾选启动管理员状态、外部网络，创建子网，写入可用域提示
- 在`子网`选项中填入子网名称，网络地址和网关等
- 在`子网详情`中根据需求是否DHCP，然后点击创建即可

### 创建Flavor
&#8195;&#8195;Flavor作为虚拟机的配置，当创建虚拟机时需要为其选择一个Flavor，也就定义了虚拟机的配置，比如1C2G120G：
- 在主菜单`计算`下`实例类型`页面中右上角点击`创建实例类型`选项
- 填入需求信息点击`创建实例类型即可`
- 在主菜单`计算`下`实例类型`页面中可以查看创建的实例类型

### 创建主机聚合
&#8195;&#8195;主机聚合作为kvm host的逻辑隔离，换言之可以指定虚拟机创建在哪个区域。下面创建主机聚合：
- 在`项目`>`计算`>`主机聚合`页面中右上角点击`创建主机聚合`选项
- 在`创建主机聚合`对话框中`主机聚合信息`中填入名称及可用域
- 在`创建主机聚合`对话框中`管理聚合内的主机`中增加主要到这个聚合
- 点击创建即可
- 在`项目`>`计算`>`主机聚合`页面中可以查看创建的主机聚合

### 创建项目
步骤如下：
- 在`项目`>`项目`>`项目`页面中右上角点击`创建项目`选项
- 在对话框`创建项目`的选项`项目信息`中填入对应的信息
- 选项`配额`中为项目输入配额（根据需求来填写）
- 点击创建项目
- 在`项目`>`项目`>`项目`页面查看创建的项目

### 创建用户并关联项目
步骤如下：
- 在主菜单`身份管理`下选择`用户`
- 在`用户`页面右上角点击`创建用户`选项
- 在`创建用户`对话框中选择项目并填写密码等信息
- 尝试用刚刚创建的用户登陆平台
