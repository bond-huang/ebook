# AS400-日志&日志接收器
&#8195;&#8195;Journals是系统对象，包含对另一系统对象进行的更改的信息。Journal可用来恢复数据库文件、数据区、数据队列和集成文件系统对象。定期进行Journal记录会加快管理任务（例如保存操作）的速度。
&#8195;&#8195;Journal管理提供了一种记录系统上对象活动的方法。使用Journal管理时，用户创建了一个称为Journal的对象。Journal以`Journal entries`的形式记录您指定的对象的活动。Journal将`Journal entries`写入另一个称为`Journal receiver`的对象中。     
官方参考链接：
- [IBM i 7.3 Logs and journals](https://www.ibm.com/docs/en/i/7.3?topic=concepts-logs-journals)
- [IBM i 7.3 Journal management](https://www.ibm.com/docs/zh/i/7.3?topic=management-journal)

## Local journal管理
官方参考链接：[IBM i 7.3 Local journal management](https://www.ibm.com/docs/zh/i/7.3?topic=management-local-journal)
### Setting up journaling
&#8195;&#8195;使用`CRTJRN`(Create Journal)命令创建Journal，使用`CRTJRNRCV`(Create Journal Receiver)命令创建Journal接收器。Setting up journaling包括创建日志和日志接收器。创建Journal时，需要以下信息：
- Journal名称，Journal分配的Library(JRN)
- 与Journal关联的Journal接收器名称及所在的Library(JRNRCV)
- 为Journal分配存储空间的磁盘池(ASP)
- Journal的消息队列及队列所在的Library(MSGQ)
- 是否使用手动或使用系统Journal接收器管理(MNGRCV)
- 是否自动删除Journal接收器(DLTRCV)
- Journal接收器大小选项(RCVSIZOPT)
- Journal的Journal对象限制(JRNOBJLMT)
- Journal的权限(AUT)
- 是否最小化特定于条目的数据(MINENTDTA)
- 是否使用Journal缓存(JRNCACHE)
- 是否延迟下一次自动更改Journal接收器的尝试(MNGRCVDLY)
- 是否延迟下一次自动删除Journal接收器的尝试(DLTRCVDLY)
- 是否在Journal分录中包含固定长度的数据(FIXLENDTA)

CL命令创建示例选项：
```
                             Create Journal (CRTJRN)         
 Type choices, press Enter.                                  
 Journal  . . . . . . . . . . . . JRN                        
   Library  . . . . . . . . . . .                  *CURLIB   
 Journal receiver . . . . . . . . JRNRCV                     
   Library  . . . . . . . . . . .                  *LIBL     
 ASP number . . . . . . . . . . . ASP            *LIBASP     
 Journal message queue  . . . . . MSGQ           QSYSOPR     
   Library  . . . . . . . . . . .                  *LIBL     
 Manage receivers . . . . . . . . MNGRCV         *SYSTEM     
 Delete receivers . . . . . . . . DLTRCV         *NO         
 Receiver size options  . . . . . RCVSIZOPT      *SYSDFT     
                           + for more values                 
 Minimize entry specific data . . MINENTDTA      *NONE       
 Journal caching  . . . . . . . . JRNCACHE       *NO       
  Manage receiver delay time . . . MNGRCVDLY      10            
 Delete receiver delay time . . . DLTRCVDLY      10            
 Fixed length data  . . . . . . . FIXLENDTA      *JOBUSRPGM    
                           + for more values                   
 Journal object limit . . . . . . JRNOBJLMT      *MAX250K      
 Text 'description' . . . . . . . TEXT           *BLANK        
                            Additional Parameters              
 Authority  . . . . . . . . . . . AUT            *LIBCRTAUT      
```
创建Journal接收器时，需要以下信息：
- Journal接收者的名字
- Journal接收器的磁盘池分配
- Journal接收器的存储阈值
- Journal接收器的权限

命令`CRTJRNRCV`示例如下：
```
Journal receiver . . . . . . . . JRNRCV                     
  Library  . . . . . . . . . . .                  *CURLIB   
ASP number . . . . . . . . . . . ASP            *LIBASP     
Journal receiver threshold . . . THRESHOLD      1500000     
Text 'description' . . . . . . . TEXT           *BLANK      
```
Setting up journaling示例官方参考链接：[IBM i 7.3 Example: Setting up journaling](https://www.ibm.com/docs/zh/i/7.3?topic=journaling-example-setting-up)

### 开启和结束Journaling以及更改Journaling属性
官方参考链接：[Starting and ending journaling and changing journaling attributes](https://www.ibm.com/docs/zh/i/7.3?topic=management-starting-ending-journaling-changing-journaling-attributes)
### 管理Journals
官方参考链接：[IBM i 7.3 Managing journals](https://www.ibm.com/docs/zh/i/7.3?topic=management-managing-journals)
#### Swapping journal receivers
&#8195;&#8195;可以使用IBM Navigator for i或使用`CHGJRN`命令Swapping日志接收器。如果使用系统日志接收器管理，系统会为用户更改日志接收器：
- 当Swapping journal receivers时，旧的日志接收器将分离
- 分离日志接收器时，用户无法将其重新附加到任何日志
- 用户可以使用分离的日志接收器执行以下操作：保存或恢复、显示条目、检索条目、接收条目、使用它来应用或删除日志更改、用它来比较日志镜像、显示其在接收器链中的状态或位置、删除、用远程日志功能复制

&#8195;&#8195;可以在`CHGJRN`命令上使用`JRNRCV(*GEN)`来创建与当前连接的接收器具有相同属性且位于同一库中的新接收器。这些属性包括所有者、私有权限、公共权限、对象审计、ASP 标识符、阈值和文本。例如Swapping新的审计日志接收器:
```
CHGJRN QSYS/QAUDJRN JRNRCV(*GEN)
```
#### 删除日志接收器
删除日志接收器的规则如下：
- 不能删除附加到本地日志的日志接收器。在删除日志接收器之前，必须执行更改日志操作(CHGJRN)以分离它
- 必须按照它们附加到日志的相同顺序删除日志接收器。
- 无论之前的限制如何，用户都可以删除损坏或无法操作的接收器。但是，如果连接的接收器损坏，则必须先detach，然后再删除
- 如果远程日志的日志状态为活动，则无法删除附加到远程日志的日志接收器。如果尝试删除附加到远程日志的接收器，系统将发送查询消息CPA705E。回复消息的结果与回复消息CPA7025的结果相同。

使用命令`DLTJRNRCV`删除日志接收器，示例删除审计日志接收器：
```
DLTJRNRCV JRNRCV(QSYS/QAUDJR0002)
```
#### Deleting journals
&#8195;&#8195;可以使用IBM Navigator for i或者命令`DLTJRN`来删除日志。示例从系统中删除库`MYLIB`中的日志`JRNLA`：
```
DLTJRN JRN(MYLIB/JRNLA)
```
#### 待补充

