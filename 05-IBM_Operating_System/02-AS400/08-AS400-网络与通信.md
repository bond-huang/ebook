# AS400-网络与通信
记录简单网络与通信管理操作。
## CFGTCP(Configure TCP/IP)
使用命令`CFGTCP`可以进入"Configure TCP/IP"菜单，选项示例：
```
1. Work with TCP/IP interfaces        
2. Work with TCP/IP routes            
3. Change TCP/IP attributes           
4. Work with TCP/IP port restrictions 
                                       
10. Work with TCP/IP host table entries
11. Merge TCP/IP host table            
12. Change TCP/IP domain information   
                                       
20. Configure TCP/IP applications      
21. Configure related tables           
22. Configure point-to-point TCP/IP    
23. Load/Unload IP Filter              
```
## NETSTAT(Work with TCP/IP Network Status)
使用命令`WRKTCPSTS`可以进入同样菜单，菜单选项示例：
```                                
1. Work with IPv4 interface status (NETSTAT *IFC)   
2. Display IPv4 route information  (NETSTAT *RTE)     
3. Work with IPv4 connection status (NETSTAT *CNN)   
4. Work with IPv6 interface status     
5. Display IPv6 route information      
6. Work with IPv6 connection status 
                                        
10. Display TCP/IP stack status  (NETSTAT *STATUS)                                     
```
IBM官方使用说明：
- IBM i 导航器:[Using Netstat from IBM Navigator for i](https://www.ibm.com/docs/en/i/7.2?topic=netstat-using-from-navigator-i)
- 字符界面使用：[Using Netstat from a character-based interface](https://www.ibm.com/docs/en/i/7.2?topic=netstat-using-from-character-based-interface)

### Work with IPv4 connection status
&#8195;&#8195;在`WRKTCPSTS`命令菜单选择`3`进入"Work with IPv4 connection status"，或者使用命令`NETSTAT *CNN`，进入后可以查看IPv4端口信息，操作选项：
- 5=Display details：可以查看基本信息和一些端口数据统计信息
- 8=Display jobs：可以看到端口对应JOB信息

### NETSTAT更多信息获取
&#8195;&#8195;通过`NETSTAT *CNN`可以查看端口的一些统计信息，但只针对端口，并且信息条目不是很多，官方提供了更多获取网络统计信息的方法：

返回有关用户`QSECOFR`的所有网络连接的信息:
```sql
SELECT * FROM QSYS2.NETSTAT_INFO WHERE BIND_USER = 'QSECOFR'
```
官方详细说明链接：[NETSTAT_INFO view](https://www.ibm.com/docs/en/i/7.2?topic=services-netstat-info-view)

返回有关使用虚拟以太网协议的所有接口的信息:
```sql
SELECT * FROM QSYS2.NETSTAT_INTERFACE_INFO WHERE INTERFACE_LINE_TYPE = 'VETH'
```
官方详细说明链接：[NETSTAT_INTERFACE_INFO view](https://www.ibm.com/docs/en/i/7.2?topic=services-netstat-interface-info-view)

返回有关使用虚拟以太网协议的所有接口的信息:
```sql
SELECT * FROM QSYS2.NETSTAT_ROUTE_INFO WHERE ROUTE_STATUS = 'YES' OR ROUTE_STATUS = 'ACTIVE'
```
官方详细说明链接：[NETSTAT_ROUTE_INFO view](https://www.ibm.com/docs/en/i/7.2?topic=services-netstat-route-info-view)

返回有关使用 IPv4 网络连接的所有作业的信息:
```sql
SELECT * FROM QSYS2.NETSTAT_JOB_INFO WHERE CONNECTION_TYPE = 'IPV4'
```
官方详细说明链接：[NETSTAT_JOB_INFO view](https://www.ibm.com/docs/en/i/7.2?topic=services-netstat-job-info-view)

AS400还有API用来抓取上面的信息：
- [List Network Interfaces (QtocLstNetIfc) API](https://www.ibm.com/docs/en/i/7.2?topic=ssw_ibm_i_72/apis/qtoclstnetifc.htm)
- [Retrieve Network Connection Data (QtocRtvNetCnnDta) API](https://www.ibm.com/docs/zh/i/7.2?topic=ssw_ibm_i_72/apis/qtocrtvnetcnndta.htm)

## 待补充