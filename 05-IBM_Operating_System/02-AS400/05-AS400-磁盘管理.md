# AS400-磁盘管理
记录简单磁盘管理操作。
## Storage Resource
命令`WRKHDWRSC *STG`可以进入`Work with Storage Resources`页面。
### 查看光纤端口WWPN
通过HMC查看（部分版本或HBA卡版本可以）：
- HMC中选中需要查看的设备的对应分区
- I/O设备列表中找到需要查看光纤卡然后查看属性
- 一般有“常规”选项，如果有“详细信息”选项，在“详细信息”选项中可以查看到端口的信息，包括WWPN

通过`WRKHDWRSC *STG`命令查看：
- 输入`WRKHDWRSC *STG`命令
- 选择DC开头的Resource，"Opt"中输入7(Display resource detail)
- 进入"Display Resource Detail"页面后翻页即可找到"World wide port name"

通过SST查看：
- 输入`STRSST`,然后输入用户密码，进入"System Service Tools (SST)"
- 输入`1`选择"Start a service tool"
- 输入`7`选择"Hardware service manager"
- 输入`1`选择"Packaging hardware resources (systems, frames, cards)"
- 输入`9`选择"System Expansion unit"
- 进入到"Packaging Hardware Resources"面板，输入`8`选择"Storage IOA"
- 在"Logical Resources Associated with a Packaging Resource"面板上，输入`5`选择"Storage IOA"
- 在"Auxiliary Storage Hardware Resource Detail"面板上，右边列中的编号为WWPN

官方参考链接：[查找运行IBM i的IBM Power Systems主机的WWPN](https://www.ibm.com/docs/zh/ds8900/9.0.2?topic=i-locating-wwpn-power-systems-hosts-running)
## 磁盘多路径
### 查看磁盘多路径
通过System Service Tools：
- 输入`STRSST`,然后输入用户密码，进入"System Service Tools (SST)"
- 选择选项"3 Work with Disk Units"
- 选择选项"1 Display disk configuration"
- 选择选项"9 Display disk path status"

通过Dedicated Service Tools：
- 以Manual方式运行初始程序装入 (IPL) 来启动系统
- 选择选项"3 Use Dedicated Service Tools (DST)"
- 使用服务工具用户密码登录到DST
- 选择选项"1 Work with disk unit"
- 选择选项"1 Work with disk configuration"
- 选择选项"1 Display disk configuration"
- 选择选项"9 Display disk path status"

通过IBM Navigator for i（端口 2001）：
- 展开"Configuration and Service"
- 展开"Hardware"
- 展开"All Hardware"
- 用鼠标右键单击磁盘单元，然后选择"Properties"

官方使用IBM Navigator for i说明：
- 展开"Configuration and Service"
- 单击"Disk Units"
- 用鼠标右键单击磁盘单元，然后选择"Properties"
- 单击窗口左侧的"Connections"

官方参考链接：[显示磁盘多路径信息和状态](https://www.ibm.com/docs/zh/ds8900/9.0.2?topic=i-displaying-disk-multipath-information-status)

## AS400与DS8000
### IBM i主机配置
运行IBM i操作系统主机的DS8000存储卷容量和型号:

大小|类型|受保护的型号|不受保护的型号
:---:|:---:|:---:|:---:
8.0GiB|2107|A01|A81
16.3GiB|2107|A02|A82
32.7GiB|2107|A05|A85
65.7GiB|2107|A04|A84
131.4GiB|2107|A06|A86
262.9GiB|2107|A07|A87
1 GiB-2000GiB|2107|099|050

官方参考链接：[Configurations for IBM Power Systems hosts running IBM i](https://www.ibm.com/docs/zh/ds8900/9.0.2?topic=i-configurations-power-systems-hosts-running)

## 磁盘空间管理
### 磁盘信息收集
&#8195;&#8195;使用命令`RTVDSKINF`可以检索磁盘信息，命令`PRTDSKINF`打印磁盘信息，或者直接使用命令`GO DISKTASKS`进入`Disk Space Tasks`菜单，示例：
```
 DISKTASKS                      Disk Space Tasks                              
 To select one of the following, type its number below and press Enter:       
      1. Collect disk space information                                       
      2. Print disk space information                                                    
     10. Work with libraries                                                  
     11. Work with folders                                                    
     12. Work with objects by owner     
```
选择`1. Collect disk space information`收集磁盘信息：
```
                        Collect Disk Space Information         
Information collected . . . . . . :                                            
A job will be submitted to collect disk space information.  This job may       
take several hours to complete, depending on the size of your system.          

Type choice below, then press Enter.                                           
  When to collect information . . .       1=Date/time                          
                                          2=Weekly                             
                                          3=Monthly     
```
&#8195;&#8195;提示可能需要几个小时时间完成，所以选择一个不繁忙时间段进行，并且尽量少进行，一周或者一月进行一次。此次测试选择了立即执行，收集完成后选择`2. Print disk space information`进行打印：
```
                          Print Disk Space Information              
 Information collected . . . . . . :   12/31/21  15:06:10                          
 Select one type of report below, then press Enter.                             
   1=Select                                                                     
 Opt     Type of Report                                                         
         Library                                                                
         Folder                                                                 
         Owner                                                                  
         Specific object                                                        
         System summary information                                             
```
此次测试选择了`Library`，spooled文件中名为`QPEZDISK`打开查看即可。
#### 收集IASP示例
示例收集用户定义的`TESTIASP`信息，直接使用命令`RTVDSKINF ASPDEV(TESTIASP)`会报错：
```
Command RTVDSKINF not allowed in this setting
```
提交后台任务可以：
```
SBMJOB CMD(RTVDSKINF ASPDEV(CBSIASP)) JOB(RTVDSKINF) JOBQ(QBATCH)
```
然后打印数据查看即可：
```
PRTDSKINF PRTTYPE(*OBJ) ASPDEV(CBSIASP) OBJ(*ALL)
```
### 磁盘清理
#### 系统自动清理
&#8195;&#8195;使用命令`Cleanup`可以查看当前系统相关配置，可以根据自己需求进行设置，也可以使用命令`STRCLNUP`计划或立即发起清理，通常系统配置如下所示：
```
                            Change Cleanup (CHGCLNUP)                         
 Type choices, press Enter.                                                   
 Allow cleanup  . . . . . . . . .   *YES          *SAME, *YES, *NO            
 Time cleanup starts each day . .   '22:00:00'    Time, *SAME, *SCDPWROFF...  
 Number of days to keep:                                                      
   User messages  . . . . . . . .   7             1-366, *KEEP, *SAME         
   System and workstation msgs  .   4             1-366, *KEEP, *SAME         
   Critical system messages . . .   *KEEP         1-366, *KEEP, *SAME         
   Job logs and system output . .   7             1-366, *KEEP, *SAME         
   System journals and logs . . .   30            1-366, *KEEP, *SAME         
 Job queue  . . . . . . . . . . .   QCTL          Name, *SAME                 
   Library  . . . . . . . . . . .     *LIBL       Name, *LIBL, *CURLIB  
```
#### 日常清理