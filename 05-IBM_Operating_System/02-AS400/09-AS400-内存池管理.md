# AS400-内存池管理
官方参考链接：
- [IBM i 7.3 Memory pools](https://www.ibm.com/docs/zh/i/7.3?topic=concepts-memory-pools)
- [IBM i 7.3 Managing memory pools](https://www.ibm.com/docs/zh/i/7.3?topic=work-managing-memory-pools)

## 查看内存池信息
### IBM Navigator for i
查看步骤如下：
- 展开Work Management > All Tasks > Memory Pools
- 选择Active Memory Pools或Shared Memory Pools

说明：
- `Active Memory Pools`显示活动状态的shared和private池
- `Shared Memory Pools`显示所有共享池，而不管它们的当前状态
- 在被子系统激活之前，不活动的私有池不存在于池定义，因此，IBM Navigator for i无法查看它们

### Character-based interface
使用命令`DSPSBSD`查看，示例查看`QCMN`子系统描述：
- 输入命令`DSPSBSD QCMN`或`DSPSBSD SBSD(QSYS/QCMN)`进入`Display Subsystem Description`面板
- 然后选择选项`2. Pool definitions`进入`Display Pool Definitions`面板
- 可以看到`Status`,`Pool ID`,`Storage Size (M)`及`Activity Level`等信息

使用命令`WRKSHRPOOL`查看：
```
WRKSHRPOOL OUTPUT(*)
```
## 确定使用内存池的子系统数量
&#8195;&#8195;子系统被分配一定比例的内存来运行作业。在了解有多少子系统正在向池提交作业以及池中正在运行多少作业后，用户可能需要通过调整池的大小和活动级别来减少资源争用。
### IBM Navigator for i
查看步骤如下：
- 展开Work Management > All Tasks > Memory Pools
- 选择Active Memory Pools或Shared Memory Pools
- 选中需要查看的内存池，然后右键，选中`Subsystems`单击

### Character-based interface
使用命令`WRKSBS`显示所有子系统及其相应池的列表，示例如下：
```
                              Work with Subsystems                    
                                                             System:  
 Type options, press Enter.                                           
   4=End subsystem   5=Display subsystem description                  
   8=Work with subsystem jobs                                         
                                     
                       Total     -----------Subsystem Pools-----------
 Opt  Subsystem     Storage (M)   1   2   3   4   5   6   7   8   9  1
      #SYSLOAD             0,00       2                               
      QBATCH               0,00   2                                                          
      QCMN                 0,00   2                                   
```
## 确定内存池中作业数量
IBM Navigator for i中查看步骤：
- 展开Work Management > All Tasks > Memory Pools
- 选择Active Memory Pools或Shared Memory Pools
- 选中需要查看的内存池，然后右键，选中`Jobs`单击
- 会弹出一个窗口，显示内存池中的作业列表

## 确定单个作业在哪个池中运行
&#8195;&#8195;如果作业未按预期执行，可能需要检查运行该作业的内存池。例如，如果分页过多，则可能需要更大的内存池，或者是池中有太多其他作业，可能需要将作业移动到其它池。
### IBM Navigator for i
查看步骤如下：
- 展开Work Management，选择Active Jobs或Server Jobs
- 找到需要查看其内存池的作业
- 在作业名称上右键，选择并点击`Properties`
- 单击`Resources`选项卡，窗口`Job Properties-Resources`显示有关作业内存池的特定信息

### Character-based interface
使用`WRKJOB`命令查看，示例查看用户`BONDHUANG`的`TESTBCH`作业：
- 输入命令`WRKJOB JOB(BONDHUANG/TESTBCH)`
- 选择选项`1. Display job status attributes`查看属性
- 显示选项中`Subsystem pool ID`属性即是需要查看的信息

使用`WRKACTJOB`命令查看活动作业的池ID，示例查看`QBATCH`子系统下作业：
- 输入命令`WRKACTJOB SBS(QBATCH)`进入`Work with Active Jobs`面板
- 按`F11`，在列`Pool`下即是池ID，对应Job查看即可

示例：
```                                              
   2=Change   3=Hold   4=End   5=Work with   6=Release   7=Display message 
   8=Work with spooled files   13=Disconnect ...                           
                                               --------Elapsed---------    
 Opt  Subsystem/Job  Type  Pool  Pty      CPU  Int    Rsp  AuxIO  CPU %    
      QBATCH         SBS     2    0    3214,0                  1    0,3    
        NFMC         BCH     2   99      55,5                  0    0,0    
        TESTBCH      BCH     2   99       2,3                  0    0,0    
                                                                         
```
## 管理共享池的可调整参数
### IBM Navigator for i
查看步骤如下：
- 展开Work Management > All Tasks > Memory Pools
- 选择Active Memory Pools或Shared Memory Pools
- 右键单击要调整的池，然后单击`Properties`
- 单击`Tuning`选项，进入`Shared Properties-Tuning`窗口
- 用户可以手动调整特定值，例如池分配百分比、每秒页面错误和优先级

### Character-based interface
使用命令`WRKSHRPOOL`，选择`11-Display tuning data`即可。

## 管理池的配置
要更改池的大小、活动级别或分页选项。
### IBM Navigator for i
步骤如下：
- 展开Work Management > All Tasks > Memory Pools
- 选择Active Memory Pools或Shared Memory Pools
- 右键单击要调整的池，然后单击`Properties`
- 单击`Configuration`选项，进入`Shared Properties-Configuration`窗口
- 可以手动调整特定值，例如池的大小、活动级别或分页选项

### Character-based interface
使用命令`WRKSHRPOOL`。
## 待补充