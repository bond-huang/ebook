# RHEL-系统网络管理
## 描述网络概念
### TCP/IP 网络模型
&#8195;&#8195;TCP/IP网络模型是一种简化的四层抽象集合，用于描述不同的协议如何进行互操作，以便计算机通过互联网将流量从一台计算机发送到另一台计算机。由`RFC 1122 互联网主机要求--通信层`规定。这四层是：
- 应用：每一应用程序具有用于通信的规范，以便客户端和服务器可以跨平台通信。常用的协议有SSH（远程登录）、HTTPS（安全Web）、NFS或CIFS（文件共享），以及SMTP（电子邮件递送）等。
- 传输：传输协议有TCP和UDP。应用协议使用TCP或UDP端口。`/etc/services`文件中可以找到常用和已注册的端口列表。协议及传输说明：
    - TCP是可靠连接导向型通信
    - UDP属于无连接数据报协议
    - 当数据包在网络上发送时，服务端口和IP地址组合形成套接字。每个数据包具有一个源套接字和目标套接字。此信息可以在监控和过滤时使用
- 互联网：互联网或网络层将数据从源主机传送到目标主机。IPv4和IPv6协议是互联网层协议。每一主机具有IP 地址和前缀，用于确定网络地址。路由器用于连接网络
- 链路：链路或介质存取层提供与物理介质的连接。最常见的网络类型是有线以太网(802.3)和无线局域网(802.11)。每一物理设备具有一个硬件地址(MAC)，用于标识局域网络段中数据包的目的地

### 描述网络接口名称
&#8195;&#8195;系统上的每个网络端口都有一个名称，可以使用该名称来配置和识别它。旧版RHEL将`eth0`、`eth1`和`eth2`等名称用于各个网络接口：
- 名称`eth0`是操作系统检测到的第一个网络端口，`eth1`则是第二个，以此类推。
- 随着设备的添加和移除，检测设备并给它们命名的机制可能会改变哪个接口获得哪个名称
- 此外，PCIe标准无法保证在启动时检测PCIe设备的顺序；鉴于设备或系统启动期间的变化，可能会意外改变设备命名

&#8195;&#8195;较新版本的RHEL采用另一种命名体系。系统将基于固件信息、PCI总线拓扑及网络设备的类型来分配网络接口名称，而非基于检测顺序。网络接口名称以接口类型开头：
- 以太网接口以`en`开头
- WLAN接口以`wl`开头
- WWAN接口以`ww`开头 

在类型之后，接口名称的其余部分将基于服务器固件所提供的信息，或由PCI拓扑中设备的位置确定：
- `oN`表示这是一个板载设备，且服务器的固件提供设备的索引编号`N`。例如`eno1`代表板载以太网设备`1`
- `sN`表示该设备位于PCI热插拔插槽`N`中。例如`ens3`代表PCI热插拔插槽`3`中的以太网卡
- `pMsN`表示这是一个位于插槽`N`中总线`M`上的PCI设备。例如`wlp4s0`代表位于插槽`0`中PCI总线`4`上的 `WLAN`卡：
    - 如果该卡是一个多功能设备（可能是有多个端口的以太网卡，或是具有以太网外加其他一些功能的设备），设备名称中就可能会添加`fN`
    - 例如`enp0s1f0`代表插槽`1`中总线`0`上的以太网卡的功能`0`。可能还有一个名为`enp0s1f1`的接口，它代表了同一设备的功能`1`

### IPv4网络
IPv4是当今互联网上使用的主要网络协议。
#### IPv4地址
&#8195;&#8195;`IPv4`地址是一个32位数字，通常使用点号分隔的四个十进制八位字节（取值范围从0到255）表示。此类地址分网络部分和主机部分：
- 位于同一子网中的所有主机可以在彼此之间直接通信，无需路由器，这些主机具有相同的网络部分
- 网络部分用于标识子网
- 同一子网中的任何两台主机都不能具有相同的主机部分
- 主机部分用于标识子网中的特定主机

&#8195;&#8195;在现代互联网中，`IPv4`子网的大小是可变的。要分清`IPv4`地址中的网络部分和主机部分，管理员必须知道分配给子网的子网掩码。子网掩码指明有多少位的IPv4地址属于子网。可供主机部分使用的位数越多，子网中就能有越多的主机：
- 有时，将子网中可能达到的最低地址（主机部分的二进制值全为零）称为网络地址
- 在IPv4中，子网中可能达到的最高地址（主机部分的二进制值全为一）用于广播消息，该地址称为广播地址

子网掩码可用两种格式表示：
- 较早的子网掩码语法中将24位用于网络部分，即`255.255.255.0`
- 较新的语法称为`CIDR`表示法，它指定了一个网络前缀`/24`。两种格式都传达同样的信息，即IP地址中有多少前导位组成其网络地址

&#8195;&#8195;特殊地址`127.0.0.1`始终指向本地系统`localhost`，而网络`127.0.0.0/8`属于本地系统，所以它能够使用网络协议与自己通信。
#### 地址计算示例
计算`192.168.1.108/24`的网络地址：

说明|十进制|二进制
:---:|:---:|:---:
主机地址|192.168.1.107|11000000.10101000.00000001.01101100
网络前缀|/24(255.255.255.0)|11111111.11111111.11111111.00000000
网络地址|192.168.1.0|11000000.10101000.00000001.00000000
广播地址|192.168.1.255|11000000.10101000.00000001.11111111

计算`10.1.1.18/8`的网络地址：

说明|十进制|二进制
:---:|:---:|:---:
主机地址|10.1.1.18|00001010.00000001.00000001.00010010
网络前缀|/8(255.0.0.0)|11111111.00000000.00000000.00000000
网络地址|10.0.0.0|00001010.00000000.00000000.00000000
广播地址|10.255.255.255|00001010.11111111.11111111.11111111

计算`172.16.180.20/19`的网络地址：

说明|十进制|二进制
:---:|:---:|:---:
主机地址|172.168.181.23|10101100.10101000.10110100.00010100
网络前缀|/19(255.255.224.0)|11111111.11111111.11100000.00000000
网络地址|172.168.160.0|10101100.10101000.10100000.00000000
广播地址|172.168.191.255|10101100.10101000.10111111.11111111

#### IPv4路由
&#8195;&#8195;不管使用`IPv4`还是`IPv6`，网络流量都需要以主机到主机和网络到网络的形式进行传输。每一主机具有一个路由表，该表告诉主机如何路由特定网络的通信：
- 路由表条目将列出目标网络、用于向其发送流量的接口，以及任何中间路由器的IP地址（用于将消息中继到最终目的地）。与网络流量目的地相符的路由表条目用于路由该流量。如果两个条目匹配，则使用前缀最长的那一个
- 如果网络流量不匹配更为具体的路由，路由表通常具有一个代表整个IPv4互联网的默认路由条目：`0.0.0.0/0`。此默认路由指向可通达的子网上的路由器（也就是说，在主机路由中具有更具体路由的子网上）
- 如果路由器收到的流量并非将其作为寻址目标，则路由器不会像普通主机那样忽略该流量，而是根据自己的路由表转发该流量。这种处理方式可能会将流量直接发送到目标主机（如果路由器恰巧与目标位于同一子网中），也可能转发到其他路由器。这种转发过程会一直进行，直到流量到达最终目标

路由表示例：
目的地|接口|路由器（若需要）
:---:|:---:|:---:
192.0.2.0/24|wlo1	 
192.168.5.0/24|enp3s0	 
0.0.0.0/0(默认)|enp3s0|192.168.5.254

示例说明：
- 从此主机发往IP地址`192.0.2.100`的流量将通过`wlo1`无线接口直接传输到该目的地，它与`192.0.2.0/24`路由的匹配度最高
- 发往IP地址`192.168.5.100`的流量将通过`enp3s0`以太网接口直接传输到该目的地，它与`192.168.5.0/24`路由的匹配度最高
- 发往IP地址`10.2.24.100`的流量将从`enp3s0`以太网接口发送到`192.168.5.254`的路由器，该路由器将该通信转发到其最终目的地。该流量与`0.0.0.0/0`路由的匹配度最高，因为此主机的路由表中没有更加具体的路由。该路由器将使用自身的路由表来判断流量需要转发到的下一个位置

#### IPv4地址和路由配置
配置方式：
- 可以在引导时从`DHCP`服务器自动配置其`IPv4`网络设置。本地客户端守护进程查询链路以获取服务器和网络设置，并获得租约以便在特定时间内使用这些设置。如果客户端未定期请求续订租约，则可能会丢失其网络配置设置
- 用户可以将服务器配置为使用静态网络配置。在这种情况下，网络设置读取自本地配置文件。用户必须从网络管理员处获取正确的设置，并根据需要手动更新它们，以避免与其他服务器冲突

### IPv6网络